#!/usr/bin/env bash
# Configure SDDM with Tokyo Night Minimal theme
# This script installs the SDDM theme to system directories

set -euo pipefail

DOTFILES_DIR="${DOT:-$HOME/.local/share/dotfiles}"
THEME_NAME="tokyonight-minimal"
THEME_SRC="${DOTFILES_DIR}/sddm/theme/${THEME_NAME}"
THEME_DEST="/usr/share/sddm/themes/${THEME_NAME}"

if [[ ! -d "${THEME_SRC}" ]]; then
    echo "Error: Theme source not found at ${THEME_SRC}"
    exit 1
fi

echo "Installing SDDM theme: ${THEME_NAME}"
echo "  From: ${THEME_SRC}"
echo "  To:   ${THEME_DEST}"
echo ""
echo "This requires sudo privileges to install to system directories."

# Copy theme files
sudo rm -rf "${THEME_DEST}"
sudo cp -r "${THEME_SRC}" "${THEME_DEST}"

# Configure SDDM to use the theme
sudo mkdir -p /etc/sddm.conf.d
sudo tee /etc/sddm.conf.d/theme.conf > /dev/null << EOF
[Theme]
Current=${THEME_NAME}

[General]
InputMethod=
EOF

echo ""
echo "Done. SDDM will use ${THEME_NAME} on next login."
echo "To test: sudo systemctl restart sddm (warning: will log you out)"
