#!/bin/sh
# extract - Multi-format archive extraction utility
# Usage: extract <archive_file> [destination]
# Supports: tar, gz, bz2, xz, zst, zip, rar, 7z, Z, deb, rpm

set -e

if [ $# -eq 0 ]; then
    echo "Usage: extract <archive_file> [destination]" >&2
    echo "Supported: .tar .tar.gz .tgz .tar.bz2 .tbz2 .tar.xz .txz .tar.zst" >&2
    echo "           .gz .bz2 .xz .zst .zip .rar .7z .Z .deb .rpm" >&2
    exit 1
fi

file="$1"
dest="${2:-.}"

if [ ! -f "$file" ]; then
    echo "extract: '$file' is not a valid file" >&2
    exit 1
fi

case "$file" in
    *.tar.bz2|*.tbz2)    tar xjf "$file" -C "$dest" ;;
    *.tar.gz|*.tgz)       tar xzf "$file" -C "$dest" ;;
    *.tar.xz|*.txz)       tar xJf "$file" -C "$dest" ;;
    *.tar.zst)            tar --zstd -xf "$file" -C "$dest" ;;
    *.tar)                tar xf "$file" -C "$dest" ;;
    *.bz2)                bunzip2 -k "$file" ;;
    *.gz)                 gunzip -k "$file" ;;
    *.xz)                 unxz -k "$file" ;;
    *.zst)                unzstd "$file" ;;
    *.zip)                unzip "$file" -d "$dest" ;;
    *.rar)                unrar x "$file" "$dest" ;;
    *.7z)                 7z x "$file" -o"$dest" ;;
    *.Z)                  uncompress "$file" ;;
    *.deb)                ar x "$file" --output "$dest" ;;
    *.rpm)                rpm2cpio "$file" | (cd "$dest" && cpio -idmv) ;;
    *)
        echo "extract: '$file' - unknown archive format" >&2
        exit 1
        ;;
esac
